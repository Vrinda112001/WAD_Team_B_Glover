{% extends 'glover/base.html' %}
{% load static %}
{% load humanize %}

{% block title_block %}
    Chat with {{ profile.username }}
{% endblock %}

{%block body_block %}

<div class="row mt-4">
    <div class="col-4">
        {% if users_messaged %}        
        <ul>
            {% for u in users_messaged %}
                <li>
                    <a href="{% url 'glover:user-messages' u.user.username %}">{{ u.user.first_name }}</a>
                </li>
            {% endfor %}
        </ul>
        {% endif %}
    </div>

    <div class="col-8">
        <div id="chat-body" class="card">
            <div class="card-header text-white"><h4>Messages with {{ profile.user.first_name }}</h4></div>
                <div class="card chatbar square scrollbar-cyan bordered-cyan">
                    <div class="card-body">
                    <ul class="text-white">
                        {% if chat %}
                            {% for message in chat %}

                                {% if message.sender == user.profile %}
                                    <li class="d-flex justify-content-between bg-info p-3">
                                        {{ message.sender }} ({{ message.time_sent|naturaltime }})<br/>
                                        {{ message.message }}
                                    </li>
                                {% else %}
                                    <li class="d-flex justify-content-between bg-success p-3">
                                        {{ message.sender }} ({{ message.time_sent|naturaltime }}) <br/>
                                        {{ message.message }}
                                    </li>
                                {% endif %}
                                <br/>
                            {% endfor %}
                        {% endif %}
                    </ul>
                    
                </div>
            </div>
        </div>



        <form id="chat_form" class="mt-5" method="post" action="{% url 'glover:user-messages' profile.user.username %}">
            {% csrf_token %}
            <div class="form-group">
                <textarea name="message-content" class="form-control" placeholder="Enter your message..." required></textarea>
            </div>

            <button type="submit" class="btn btn-lg btn-primary mb-5">Send</button>
        </form>
    </div>
</div>

{% endblock %}

{% block js %}

<script>

$(document).ready(function() {
    var chatbox = document.querySelector('.chatbar');
    chatbox.scrollTop = 200000000
})

</script>
{% endblock %}